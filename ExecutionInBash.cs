using System.Diagnostics;

namespace vulnerability_demo_os_command_injection
{
  public class ExecutionInBash : IOsCommandExecution
  {
    private Process _process;

    public ExecutionInBash(string execution)
    {
      this._process = new Process()
      {
        StartInfo = new ProcessStartInfo
        {
          FileName = "/bin/bash",
          Arguments = $"-c \"{execution}\"",
          RedirectStandardOutput = true,
          UseShellExecute = false,
          CreateNoWindow = true,
        }
      };
    }

    public string Execute()
    {
      System.Console.WriteLine($"Executing: {this._process.StartInfo.FileName} {this._process.StartInfo.Arguments}");

      this._process.Start();
      string result = this._process.StandardOutput.ReadToEnd();
      this._process.WaitForExit();

      return result;
    }
  }
}